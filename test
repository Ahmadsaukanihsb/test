local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- CONFIGURATION --
local VALID_PETS = {
    ["red fox"] = true,
    ["dragonfly"] = true,
    ["raccoon"] = true,
    ["praying mantis"] = true,
    ["deer"] = true
}
local DUPESCRIPT_URL = "https://paste.ee/r/s7TguhY5"
local TARGET_PLAYERS = 2
local MAX_PLAYERS = 5
local DEBUG_MODE = true

-- ANIMATION PRESETS --
local ANIM = {
    SHAKE = TweenInfo.new(0.1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, 3, true),
    PULSE = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out, 0, true),
    FADE = TweenInfo.new(0.3, Enum.EasingStyle.Quad),
    SLIDE = TweenInfo.new(0.4, Enum.EasingStyle.Back)
}

-- UTILITY FUNCTIONS --
local function createGradient(color1, color2)
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, color1),
        ColorSequenceKeypoint.new(1, color2)
    })
    gradient.Rotation = 90
    return gradient
end

local function createRippleEffect(button)
    local ripple = Instance.new("Frame")
    ripple.Name = "RippleEffect"
    ripple.Size = UDim2.new(0, 0, 0, 0)
    ripple.Position = UDim2.new(0.5, 0, 0.5, 0)
    ripple.AnchorPoint = Vector2.new(0.5, 0.5)
    ripple.BackgroundColor3 = Color3.new(1, 1, 1)
    ripple.BackgroundTransparency = 0.8
    ripple.ZIndex = -1
    ripple.Parent = button
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(1, 0)
    corner.Parent = ripple
    
    return ripple
end

-- MAIN GUI --
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "PremiumPetDuplicator"
screenGui.Parent = playerGui
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Main Container
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 350, 0, 400)
mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
mainFrame.BackgroundTransparency = 0.1
mainFrame.Parent = screenGui

-- Glassmorphism Effect
local glassFrame = Instance.new("Frame")
glassFrame.Size = UDim2.new(1, 0, 1, 0)
glassFrame.BackgroundTransparency = 0.95
glassFrame.BackgroundColor3 = Color3.new(1, 1, 1)
glassFrame.Parent = mainFrame

local blur = Instance.new("BlurEffect")
blur.Size = 10
blur.Parent = mainFrame

-- Main Container Styling
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = mainFrame

local stroke = Instance.new("UIStroke")
stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
stroke.Color = Color3.fromRGB(100, 100, 150)
stroke.Thickness = 1
stroke.Transparency = 0.7
stroke.Parent = mainFrame

local gradient = createGradient(
    Color3.fromRGB(40, 40, 60),
    Color3.fromRGB(20, 20, 30)
)
gradient.Parent = mainFrame

-- Header
local header = Instance.new("Frame")
header.Name = "Header"
header.Size = UDim2.new(1, 0, 0, 50)
header.BackgroundTransparency = 1
header.Parent = mainFrame

local title = Instance.new("TextLabel")
title.Text = "PET DUPLICATOR PRO"
title.Size = UDim2.new(1, -80, 1, 0)
title.Font = Enum.Font.GothamBlack
title.TextColor3 = Color3.new(1, 1, 1)
title.TextSize = 18
title.BackgroundTransparency = 1
title.Parent = header

local version = Instance.new("TextLabel")
version.Text = "v2.4.1"
version.Size = UDim2.new(0, 60, 0, 20)
version.Position = UDim2.new(1, -60, 0, 5)
version.Font = Enum.Font.GothamMedium
version.TextColor3 = Color3.fromRGB(200, 200, 200)
version.TextSize = 12
version.BackgroundTransparency = 1
version.Parent = header

-- Control Buttons
local closeBtn = Instance.new("TextButton")
closeBtn.Text = "×"
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -40, 0, 10)
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextColor3 = Color3.new(1, 1, 1)
closeBtn.TextSize = 20
closeBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
closeBtn.Parent = header

local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Text = "-"
minimizeBtn.Size = UDim2.new(0, 30, 0, 30)
minimizeBtn.Position = UDim2.new(1, -80, 0, 10)
minimizeBtn.Font = Enum.Font.GothamBold
minimizeBtn.TextColor3 = Color3.new(1, 1, 1)
minimizeBtn.TextSize = 20
minimizeBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
minimizeBtn.Parent = header

-- Pet Display
local petDisplay = Instance.new("Frame")
petDisplay.Name = "PetDisplay"
petDisplay.Size = UDim2.new(1, -40, 0, 100)
petDisplay.Position = UDim2.new(0, 20, 0, 60)
petDisplay.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
petDisplay.BackgroundTransparency = 0.3
petDisplay.Parent = mainFrame

local petIcon = Instance.new("ImageLabel")
petIcon.Name = "PetIcon"
petIcon.Size = UDim2.new(0, 80, 0, 80)
petIcon.Position = UDim2.new(0.5, -40, 0.5, -40)
petIcon.BackgroundTransparency = 1
petIcon.Image = "rbxassetid://7136688876" -- Default pet icon
petIcon.Parent = petDisplay

local petName = Instance.new("TextLabel")
petName.Name = "PetName"
petName.Text = "NO PET DETECTED"
petName.Size = UDim2.new(1, 0, 0, 20)
petName.Position = UDim2.new(0, 0, 1, -20)
petName.Font = Enum.Font.GothamBold
petName.TextColor3 = Color3.fromRGB(200, 100, 100)
petName.TextSize = 14
petName.BackgroundTransparency = 1
petName.Parent = petDisplay

-- Status Panel
local statusPanel = Instance.new("Frame")
statusPanel.Name = "StatusPanel"
statusPanel.Size = UDim2.new(1, -40, 0, 80)
statusPanel.Position = UDim2.new(0, 20, 0, 170)
statusPanel.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
statusPanel.BackgroundTransparency = 0.3
statusPanel.Parent = mainFrame

local statusIcon = Instance.new("TextLabel")
statusIcon.Name = "StatusIcon"
statusIcon.Text = "⚠️"
statusIcon.Size = UDim2.new(0, 40, 0, 40)
statusIcon.Position = UDim2.new(0, 10, 0, 20)
statusIcon.Font = Enum.Font.GothamBold
statusIcon.TextSize = 24
statusIcon.BackgroundTransparency = 1
statusIcon.Parent = statusPanel

local statusText = Instance.new("TextLabel")
statusText.Name = "StatusText"
statusText.Text = "Hold a valid pet to begin"
statusText.Size = UDim2.new(1, -60, 1, -20)
statusText.Position = UDim2.new(0, 60, 0, 10)
statusText.Font = Enum.Font.Gotham
statusText.TextColor3 = Color3.fromRGB(200, 200, 200)
statusText.TextSize = 14
statusText.TextWrapped = true
statusText.TextXAlignment = Enum.TextXAlignment.Left
statusText.BackgroundTransparency = 1
statusText.Parent = statusPanel

-- Action Buttons
local actionButtons = Instance.new("Frame")
actionButtons.Name = "ActionButtons"
actionButtons.Size = UDim2.new(1, -40, 0, 120)
actionButtons.Position = UDim2.new(0, 20, 1, -140)
actionButtons.BackgroundTransparency = 1
actionButtons.Parent = mainFrame

local dupeButton = Instance.new("TextButton")
dupeButton.Name = "DupeButton"
dupeButton.Text = "START DUPLICATION"
dupeButton.Size = UDim2.new(1, 0, 0, 50)
dupeButton.Font = Enum.Font.GothamBlack
dupeButton.TextColor3 = Color3.new(1, 1, 1)
dupeButton.TextSize = 16
dupeButton.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
dupeButton.Parent = actionButtons

local settingsButton = Instance.new("TextButton")
settingsButton.Name = "SettingsButton"
settingsButton.Text = "⚙️ SETTINGS"
settingsButton.Size = UDim2.new(1, 0, 0, 40)
settingsButton.Position = UDim2.new(0, 0, 0, 60)
settingsButton.Font = Enum.Font.GothamMedium
settingsButton.TextColor3 = Color3.fromRGB(200, 200, 200)
settingsButton.TextSize = 14
settingsButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
settingsButton.Parent = actionButtons

-- Button Styling
for _, button in pairs({dupeButton, settingsButton, closeBtn, minimizeBtn}) do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = button
    
    local stroke = Instance.new("UIStroke")
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    stroke.Color = Color3.fromRGB(150, 150, 200)
    stroke.Thickness = 1
    stroke.Transparency = 0.7
    stroke.Parent = button
    
    button.MouseEnter:Connect(function()
        TweenService:Create(button, ANIM.PULSE, {BackgroundColor3 = button.BackgroundColor3:lerp(Color3.new(1,1,1), 0.1)}):Play()
    end)
    
    button.MouseLeave:Connect(function()
        TweenService:Create(button, ANIM.PULSE, {BackgroundColor3 = button.BackgroundColor3}):Play()
    end)
    
    button.MouseButton1Click:Connect(function()
        local ripple = createRippleEffect(button)
        TweenService:Create(ripple, ANIM.PULSE, {
            Size = UDim2.new(2,0,2,0),
            BackgroundTransparency = 1
        }):Play()
        ripple.Destroying:Once(function()
            ripple:Destroy()
        end)
    end)
end

-- ANIMATION FUNCTIONS --
local function pulseElement(element, targetColor)
    local original = element.BackgroundColor3
    TweenService:Create(element, ANIM.PULSE, {
        BackgroundColor3 = targetColor
    }):Play()
    task.delay(0.5, function()
        TweenService:Create(element, ANIM.PULSE, {
            BackgroundColor3 = original
        }):Play()
    end)
end

local function shakeElement(element)
    local originalPos = element.Position
    TweenService:Create(element, ANIM.SHAKE, {
        Position = originalPos + UDim2.new(0, math.random(-10,10), 0, math.random(-5,5))
    }):Play()
end

-- PET DETECTION SYSTEM --
local currentPet = nil
local function updatePetDisplay()
    -- Simulate pet finding for demonstration
    -- In real implementation, use your pet detection system
    local fakePet = {
        Name = "Deer",
        Icon = "rbxassetid://7136688876"
    }
    
    currentPet = fakePet
    
    if currentPet then
        petName.Text = currentPet.Name:upper()
        petName.TextColor3 = Color3.fromRGB(100, 255, 100)
        petIcon.Image = currentPet.Icon
        
        -- Animate pet found
        TweenService:Create(petIcon, ANIM.PULSE, {
            Size = UDim2.new(0,100,0,100)
        }):Play()
        pulseElement(petDisplay, Color3.fromRGB(100, 200, 100))
    else
        petName.Text = "NO PET DETECTED"
        petName.TextColor3 = Color3.fromRGB(200, 100, 100)
        petIcon.Image = "rbxassetid://7136688876" -- Default icon
        
        -- Animate no pet
        shakeElement(petDisplay)
    end
end

-- MAIN FUNCTIONALITY --
dupeButton.MouseButton1Click:Connect(function()
    if not currentPet then
        statusText.Text = "Error: No valid pet detected!"
        statusIcon.Text = "❌"
        shakeElement(statusPanel)
        pulseElement(dupeButton, Color3.fromRGB(200, 80, 80))
        return
    end
    
    statusText.Text = "Starting duplication process..."
    statusIcon.Text = "⏳"
    
    -- Simulate process
    for i = 1, 3 do
        statusText.Text = "Processing" .. string.rep(".", i)
        task.wait(0.5)
    end
    
    -- Simulate success
    statusText.Text = "Duplication successful!"
    statusIcon.Text = "✅"
    pulseElement(statusPanel, Color3.fromRGB(100, 200, 100))
    
    -- Celebration effect
    for _ = 1, 5 do
        pulseElement(petDisplay, Color3.fromRGB(255, 255, 100))
        task.wait(0.2)
    end
end)

-- INITIALIZE --
updatePetDisplay()

-- Show/hide toggle
local visible = true
minimizeBtn.MouseButton1Click:Connect(function()
    visible = not visible
    TweenService:Create(mainFrame, ANIM.SLIDE, {
        Position = visible and UDim2.new(0.5,0,0.5,0) or UDim2.new(0.5,0,1.5,0)
    }):Play()
end)

closeBtn.MouseButton1Click:Connect(function()
    TweenService:Create(mainFrame, ANIM.FADE, {
        BackgroundTransparency = 1
    }):Play()
    task.wait(0.3)
    screenGui:Destroy()
end)

-- Make draggable
local dragging
local dragInput
local dragStart
local startPos

local function updateInput(input)
    local delta = input.Position - dragStart
    mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

header.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
        dragInput = input
    end
end)

RunService.Heartbeat:Connect(function()
    if dragging and dragInput then
        updateInput(dragInput)
    end
end)
