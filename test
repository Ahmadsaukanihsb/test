-- Services
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService") -- Untuk efek hover jika diperlukan nanti

-- GUI Elements
local mainMenuGui = script.Parent
local toggleButton = mainMenuGui:WaitForChild("ToggleButton")
local menuBackground = mainMenuGui:WaitForChild("MenuBackground")
local equipButton = mainMenuGui:WaitForChild("EquipButton")
local uiCloseButton = menuBackground:FindFirstChild("UICloseButton") -- Opsional, jika Anda membuatnya

local itemButtons = {} -- Kita akan isi ini nanti jika ingin animasi per item
for _, child in ipairs(menuBackground:GetChildren()) do
    if child:IsA("ImageButton") and child.Name:match("Item") then -- Hanya ambil ImageButton yang namanya "Item..."
        table.insert(itemButtons, child)
    end
end

-- Animation Settings
local fadeInInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
local fadeOutInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
local scaleUpInfo = TweenInfo.new(0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out) -- Untuk hover
local scaleDownInfo = TweenInfo.new(0.2, Enum.EasingStyle.Back, Enum.EasingDirection.In) -- Kembali dari hover
local clickInfo = TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

-- State
local menuIsOpen = false
local selectedItem = nil -- Untuk menyimpan item yang dipilih

-- Function to toggle menu visibility
local function toggleMenu()
    menuIsOpen = not menuIsOpen
    menuBackground.Visible = menuIsOpen
    equipButton.Visible = menuIsOpen and (selectedItem ~= nil) -- Hanya tampilkan Equip jika menu terbuka dan ada item terpilih

    local targetPosition
    local targetTransparency

    if menuIsOpen then
        -- Animasi masuk
        menuBackground.Position = UDim2.new(0.5, 0, 0.45, 0) -- Posisi awal sedikit ke atas
        menuBackground.BackgroundTransparency = 1
        for _, item in ipairs(itemButtons) do
            item.ImageTransparency = 1
            item.BackgroundTransparency = 1 -- Jika ada background color di button
        end
        equipButton.Position = UDim2.new(0.5, 0, 0.85, 0) -- Posisi awal Equip button
        equipButton.BackgroundTransparency = 1

        local menuAppearTween = TweenService:Create(menuBackground, fadeInInfo, {
            Position = UDim2.new(0.5, 0, 0.5, 0), -- Posisi tengah
            BackgroundTransparency = 0 -- Sesuaikan dengan transparansi desain Anda
        })
        menuAppearTween:Play()

        -- Animasi item muncul satu per satu (opsional, lebih advance)
        for i, item in ipairs(itemButtons) do
            task.wait(0.05 * i) -- Delay kecil antar item
            local itemAppearTween = TweenService:Create(item, fadeInInfo, {
                ImageTransparency = 0,
                BackgroundTransparency = 0 -- Sesuaikan
            })
            itemAppearTween:Play()
        end

        if selectedItem then
            local equipAppearTween = TweenService:Create(equipButton, fadeInInfo, {
                Position = UDim2.new(0.5, 0, 0.8, 0), -- Posisi Equip button
                BackgroundTransparency = 0 -- Sesuaikan
            })
            equipAppearTween:Play()
        end

    else
        -- Animasi keluar
        local menuDisappearTween = TweenService:Create(menuBackground, fadeOutInfo, {
            Position = UDim2.new(0.5, 0, 0.45, 0), -- Kembali ke atas
            BackgroundTransparency = 1
        })
        menuDisappearTween:Play()

        for _, item in ipairs(itemButtons) do
            local itemDisappearTween = TweenService:Create(item, fadeOutInfo, {
                ImageTransparency = 1,
                BackgroundTransparency = 1
            })
            itemDisappearTween:Play()
        end

        local equipDisappearTween = TweenService:Create(equipButton, fadeOutInfo, {
            Position = UDim2.new(0.5, 0, 0.85, 0),
            BackgroundTransparency = 1
        })
        equipDisappearTween:Play()

        -- Setelah animasi selesai, sembunyikan secara paksa jika belum
        task.wait(fadeOutInfo.Time)
        if not menuIsOpen then -- Cek lagi karena bisa saja user klik cepat
            menuBackground.Visible = false
            equipButton.Visible = false
        end
    end
end

-- Function for item hover effect
local function onItemHover(item, enter)
    local currentSize = item.Size
    local targetSize
    local tweenInfoToUse

    if enter then
        targetSize = currentSize * 1.1 -- Sedikit membesar
        tweenInfoToUse = scaleUpInfo
        item.ZIndex = 2 -- Bawa ke depan agar tidak tertutup item lain saat scale
    else
        targetSize = currentSize / 1.1 -- Kembali ke ukuran normal
        tweenInfoToUse = scaleDownInfo
        item.ZIndex = 1
    end

    local scaleTween = TweenService:Create(item, tweenInfoToUse, {Size = targetSize})
    scaleTween:Play()
end

-- Function for item click effect & selection
local function onItemClick(item)
    -- Efek klik visual
    local originalSize = item.Size
    local clickTweenDown = TweenService:Create(item, clickInfo, {Size = originalSize * 0.9})
    local clickTweenUp = TweenService:Create(item, clickInfo, {Size = originalSize})

    clickTweenDown:Play()
    clickTweenDown.Completed:Wait()
    clickTweenUp:Play()

    -- Logika pemilihan item
    if selectedItem then
        -- Reset tampilan item yang sebelumnya dipilih (jika ada)
        -- Misalnya, reset border atau background color
        selectedItem.BorderSizePixel = 0
    end

    selectedItem = item
    -- Tandai item yang dipilih (misalnya dengan border)
    item.BorderSizePixel = 2
    item.BorderColor3 = Color3.fromRGB(255, 255, 0) -- Kuning sebagai contoh

    print(item.Name .. " dipilih!")

    -- Tampilkan dan animasikan tombol Equip
    if menuIsOpen then
        equipButton.Visible = true
        equipButton.BackgroundTransparency = 1
        equipButton.Position = UDim2.new(0.5, 0, 0.85, 0)
        local equipAppearTween = TweenService:Create(equipButton, fadeInInfo, {
            Position = UDim2.new(0.5, 0, 0.8, 0),
            BackgroundTransparency = 0 -- Sesuaikan
        })
        equipAppearTween:Play()
    end
end

-- Function for EquipButton click
local function onEquipClick()
    if selectedItem then
        print("Meng-equip: " .. selectedItem.Name)
        -- Tambahkan logika equip di sini
        -- Misalnya, memberitahu server, mengubah tampilan karakter, dll.

        -- Setelah equip, mungkin tutup menu atau reset pilihan
        selectedItem.BorderSizePixel = 0
        selectedItem = nil
        equipButton.Visible = false
        -- toggleMenu() -- Opsional: tutup menu setelah equip
    else
        print("Tidak ada item yang dipilih untuk di-equip.")
    end
end


-- Event Connections
toggleButton.MouseButton1Click:Connect(toggleMenu)

if uiCloseButton then
    uiCloseButton.MouseButton1Click:Connect(toggleMenu)
end

for _, itemButton in ipairs(itemButtons) do
    itemButton.MouseEnter:Connect(function()
        onItemHover(itemButton, true)
    end)
    itemButton.MouseLeave:Connect(function()
        onItemHover(itemButton, false)
    end)
    itemButton.MouseButton1Click:Connect(function()
        onItemClick(itemButton)
    end)
end

equipButton.MouseButton1Click:Connect(onEquipClick)

-- Inisialisasi: Sembunyikan menu saat game dimulai
menuBackground.Visible = false
equipButton.Visible = false
menuBackground.BackgroundTransparency = 1
equipButton.BackgroundTransparency = 1
for _, item in ipairs(itemButtons) do
    item.ImageTransparency = 1
    item.BackgroundTransparency = 1
end
